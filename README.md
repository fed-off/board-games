# Монополия

## Правила
https://www.ixbt.com/live/offtopic/obzor-nastolnoy-igry-monopoliya-golosovoe-upravlenie.html

Количество игроков: 2-4

### Комплектация
Перед нами коробка с изображением талисмана игры — Богатый дядюшка Пеннибэгс. Внутри ожидает вас полный комплект для полноценной игры:
- игровое поле. Каждый участок- это возможность пройти по пути к финансовой победе и успеху.
- ключевым элементом игры является банковский интерактивный терминал-цилиндр. Он позволяет контролировать и распределять деньги, создавая атмосферу финансовой интриги.
- четыре фишки
- два кубика
- 16 карт собственности. Покупайте, продавайте и сдавайте их в аренду, чтобы увеличивать свой капитал.
- карта выхода из тюрьмы
- 4 карты памятки, чтобы всегда помнить основные правила
- 8 фигурок домиков, которые помогут создать свой уникальный и благополучный городок.
- 12 фигурок гостиниц

В игре нет бумажных денег монополия, банковских карт игроков, карт из Общего сундука и физических карт Шанса. Продажа (недвижимости, зданий) и закладывание недвижимости в качестве опций в этой игре недоступны. В этой игре меньше игровых элементов, чем почти во всех изданиях монополия, поэтому беспорядка меньше или его вообще нет.

### Цель игры
Цель-классическая. Стать богатым и достичь финансовой независимости, покупая и развивая недвижимость, строя предприятия и торгуя ресурсами. Игроки должны уметь управлять своими финансами, строить свою империю и бороться за контроль над рынком. В конечном итоге игрок, который останется единственным игроком на доске, выигрывает игру.

### Игровой процесс
Игра начинается с определения того, кто будет первым ходить. Это определяется при помощи броска кубиков, причем тот, кто выбросил наибольшее число, получает право первого хода. После этого игрок начинает двигать свою фишку по полю в соответствии с результатом броска. В зависимости от участка, на котором остановилась фишка, игрок выполняет ее характеристику (покупает, платит аренду, едет на поезде и т. д.). Затем ход передается следующему игроку по кругу, и весь процесс повторяется.

Игра закончится, когда только 1 игрок станет банкротом. Активы оставшихся игроков (наличные на счете и имущество) будут подсчитаны для объявления победителя. Мистер Монополия объявляет оставшихся игроков. Игрок, набравший наибольшее количество очков в конце игры, становится победителем

### Ход игры
В начале игры шляпа размещается в центре игрового поля. Кнопки фигурок должны быть обращены по бокам игрового поля, чтобы их было легко достать (как рукой, так и голосом). Каждый игрок выбирает фигурку. Они должны находиться на той стороне, на которой кнопка соответствует их фигуре. Чтобы сыграть, игрок должен нажать кнопку соответствующей фигуры, чтобы начать с 1500 долларов. Все игроки кладут свои фигуры на игровое поле.

Все игроки бросают оба кубика, чтобы определить порядок игры. Первым начинает тот, кто бросил больше, затем игра идет направо. (При желании игроки могут решить, что первым будет ходить самый младший игрок. Возможны и другие варианты).Если вы приземлились на клетку, следуйте инструкциям для этой клетки. После выполнения действия ваш ход заканчивается. Однако, если вы выкинули дубль, вы можете сделать еще один ход и бросить еще раз. Если вы выкинули дубль три раза подряд, вы должны отправиться в тюрьму и НЕ МОЖЕТЕ выполнить действие при третьем броске дубля.

*Игровое поле:* Если вы попадаете на бесхозную клетку, вы можете либо купить обьект, либо продать на аукционе. Если вы находитесь на территории, принадлежащей другому игроку, вы должны платить арендную плату, если вас об этом попросят. Если это поле ваше, то вы ничего не делаете

*Поездка на поезде:* Если вы приземлитесь на этом месте, вам придется ехать по железной дороге. Нажмите кнопку своей фигуры и скажите «Поездка на поезде». Мистер Монополия подскажет вам, куда идти.

*Карта шанс:* Если вы приземлитесь на этом месте, нажмите кнопку своей фигуры и скажите «карта шанс» Мистер Монополия возьмет карту и что-то скажет. Вы должны выполнить действие в соответствии с его словами. Если он скажет взять карту «Выйти из тюрьмы бесплатно», вы должны взять эту единственную физическую карту «выйти из тюрьмы» в этой игре.

*Торговля:* Если вы приземляетесь на это место, у вас есть возможность принудительного обмена. Если вы решили обменять, нажмите кнопку своей фигуры и скажите «обмен». Произойдет торговая операция. Если сделка завершена, с вашего счета будет снято $100. Если вы решили не торговать, то ничего не делайте.

*Тюрьма / Просто в гостях:* Если вы приземлитесь на этом месте, поместите свою фигуру в часть «только для посещения».

*Бесплатная парковка:* Просто ничего не делать.

*Попасть в тюрьму:* Если вы приземлитесь на это место, немедленно переместите свою фигуру в тюрьму на другой стороне доски. Вы не можете получить $200 за прохождение «вперед». Выйти из тюрьмы можно 3 способами: заплатить $50, кидать 3 раза кубики, чтобы выпал дубль, с помощью карточки «выйти из тюрьмы бесплатно»

*Вперед:* Если вы доберетесь до этого места, получите 200 долларов, нажав кнопку своей фигуры и сказав «вперед».

*Недвижимость:* В этой игре 16 объектов недвижимости. Все эти объекты — улицы, поэтому здесь нет железных дорог и коммунальных служб. Если вы попали на участок, который не находится в собственности, вы можете либо купить его, либо выставить на аукцион.

*Покупка:* Если вы хотите купить объект за определенную цену, нажмите кнопку жетона, чтобы выполнить эту процедуру. Скажите «купить». Если вы услышите звук пинга, продолжайте. Произнесите название бесхозного объекта, на который вы только что приземлились. Если процедура завершена, мистер Монополия снимет с вашего счета сумму, равную цене покупки, и подарит вам собственность.

*Аукцион:* Если вы не хотите покупать собственность или у вас недостаточно денег, вы должны выставить ее на аукцион. Для выполнения этой процедуры нажмите кнопку жетона. Произнесите «аукцион «. Если вы услышите звук пинга, продолжайте. Произнесите название бесхозного имущества, на которое вы только что встали. Если процедура завершена, «Мистер Монополия» начнет аукцион. Все игроки (включая вас и игроков, находящихся в тюрьме) могут участвовать в аукционе. Аукцион начинается с $50. Первый участник аукциона, нажавший на свою кнопку-жетон, сделает ставку в $50. Каждый раз, когда нажимается кнопка с фигурой, ставка увеличивается на $50. Если в течение длительного времени не нажимается ни одна кнопка, мистер Монополия что-то скажет в ходе аукциона. По окончании аукциона г-н Монополия отдает выставленное на аукцион имущество тому, кто сделал наибольшую ставку. Перед тем как отдать имущество, из счета того, кто сделал наибольшую ставку, будет вычтена сумма ставки. Если никто не сделает ставки и аукцион закончится, то выставленная на аукцион собственность так и останется бесхозной.

Если вы приземляетесь на территории, принадлежащей другому игроку, вы должны оплатить аренду, если владелец попросит вас заплатить. Если это произойдет, вы должны нажать кнопку с вашей фигурой и выполнить процедуру. Скажите «оплачивайте аренду «. Если вы услышите звук пинга, продолжайте. Назовите собственность другого игрока, на которую вы только что приземлились, чтобы оплатить аренду. Если процедура будет завершена, мистер Монополия снимет соответствующую сумму арендной платы с вашего счета и переведет на счет владельца недвижимости.

*Строительство домов и отелей:* Если у вас есть все 2 объекта недвижимости одного цвета, вы можете построить Дом или гостиницу для этого набора цветов. Вам не обязательно строить Дом, чтобы построить отель, поэтому вы можете построить отель с самого начала. Несмотря на то, что отель в два раза дороже Дома, сумма арендной платы за отель, которую вы можете получить, очень значительна. Вы можете построить Дом или отель в любое время, даже если не ваша очередь или когда вы находитесь в тюрьме. Чтобы построить Дом или отель, нажмите кнопку с вашим токеном и следуйте процедуре.

Скажите «постройте дом» или «постройте отель». Если мистер Монополия спросит «На какой собственности?», продолжайте. Назовите свою собственность, на которой вы хотите построить Дом или гостиницу. После завершения процедуры мистер Монополи вычтет стоимость Дома или отеля из вашего счета. Цена указана в карточке, подтверждающей право собственности. Затем вы размещаете Дом или Гостиницу на своей территории, на которой хотите построить. Как только Дом или Гостиница будут размещены там, вы не сможете удалить их, чтобы продать. Однако позже вы можете переделать Дом в отель. Удаление происходит, когда у вас есть долги и вы продаете недвижимость, на которой есть здание. Если вы откажетесь от одного объекта недвижимости, чтобы погасить свой долг, здание в другом объекте того же цвета также будет удалено.

*Торговля:* Если вы попадете на «Торговую» площадку, у вас есть возможность обменять свою собственность на собственность другого игрока. Если вы решите совершить принудительную сделку, нажмите кнопку с вашим токеном и следуйте процедуре. Скажи «торговля». Если вы услышите звук пинга, продолжайте. Назовите свою собственность, которую вы хотите отдать. Если мистер Монополия спросит «Для какой собственности?», продолжайте. Назовите свойство, которое вы хотите забрать у ДРУГОГО ИГРОКА. Если процедура будет завершена, мистер Монополия совершит транзакцию. Он снимет 100 долларов с вашего счета, чтобы начать принудительную торговлю. Затем он поменяет 2 объекта недвижимости в соответствии с тем, что вы ему сказали. Банк знает новых владельцев этих объектов недвижимости. Не все объекты недвижимости могут быть проданы в определенное время. Вы не можете взять (или передать) свойство из набора цветов, если этот набор цветов основан на любом из двух его свойств. Однако вы можете взять свойство из полного набора цветов, если этот набор цветов НЕ имеет привязки ни к одному из двух своих свойств.

*В долгах и банкротстве:* Если вы оказались на чужой территории, но у вас недостаточно наличных на счету, чтобы оплатить необходимую аренду, вы в долгу. Если это произойдет, вот процедура. Мистер Монополия переводит оставшуюся сумму наличных с вашего счета владельцу объекта недвижимости. Он спросит, от какой из вашей недвижимости вы откажетесь. Ответьте на этот вопрос, назвав вашу собственность, от которой вы должны отказаться. Он отдаст это имущество кредитору (игроку, который получает от вас арендную плату). Отданный только 1 объект недвижимости (независимо от его стоимости) погасит все ваши оставшиеся долги. Если в переданной собственности есть здание, это здание будет демонтировано и возвращено Банку. Если переданный объект является частью полного набора цветов, здание (если таковое имеется) в другом объекте того же цвета также будет удалено и передано Банку. Если у вас осталось только 1 имущество и вы в долгах, вы объявляетесь банкротом и игра окончена.





## Модель данных (примерно)

*Boards* - игровое поле (сначала только одно)
- startedAt - дата начала игры (null - игра не начата)
- currentPlayer - чей ход

*Users* - пользователи, которые заходят на сайт
- ip - ip-адрес пользователя
- active - активна ли websocket-сессия
- firstVisit - дата первого посещения
- lastVisit - дата последнего посещения

*Players* - игроки
- userId - ссылка на user
- boardId - ссылка на board
- name
- chip - фишка: cat, dog, racer, dino
- balance
- capital - активы
- position - позиция на доске
- ready - готов ли к началу игры

*Cells* - клетки игрового поля
- boardId - ссылка на board
- name - название клетки
- type - тип клетки (пустая, собственность, шанс, тюрьма, парковка, ...)
- price - цена покупки
- rent - арендная плата
- owner - ссылка на player
или
*Properties* - собственность игроков
- propertyId - ссылка на клетку
- playerId - ссылка на player
- modificators - модификаторы аренды (дом, отель)
*PropertyTemplates* - шаблоны собственности (в коде)
- name
- color
- prices: {base, house, hotel}
- rent: {base, house, hotel}


## Игровой процесс

### Начало игры
#### Пользователь заходит на сайт.
Фронт создает подключение с сервером через websocket.
Сервер создаёт/обновляет запись в Users новую и отправляет в ответ event hello с текущим состоянием игры. Пока что ограничимся, списком players, которые уже находятся на доске, чтобы фронт мог их отобразить. А также chip - выбранная пользователем фигурка, если он уже выбрал фигурку (на случай потери соединения) Пример:
```
{
  event: 'hello',
  data: {
    chip: null,
    players: [
      {chip: 'car', balance: 1500, position: 0},
      {chip: 'hat', balance: 1500, position: 0},
    ]
  }
}
```

#### Пользователь выбирает за какую фигурку он будет играть
Пользователь нажимает на свободную карточку и фронт отправляет на сервер event selectChip с именем фигурки. Сервер создаёт запись в Players и отправляет всем игрокам event playerJoined, фронт должен отобразить это поле как занятое. Пример:
```
{
  event: 'selectChip',
  data: {chip: 'car'}
}
{
  event: 'playerJoined',
  data: {
    player: {chip: 'car', balance: 1500, position: 0}
  }
}
```
#### Старт игры
Когда все игроки выбрали фигурки, каждый из них должен нажать на кнопку "начать игру", фронт отправляет на сервер event startGame. Сервер проверяет что все игроки отправили startGame и обновляет статус в Boards и отправляет всем игрокам event gameStarted. Пример:
```
{
  event: 'startGame',
  data: {}
}
{
  event: 'gameStarted',
  data: {}
}
```

# v 2.0
## Начало и конец игры
Будет кнопка Сброс, которая
- возвращает все фишки, домики на места, сбрасывает баланс, принадлежность карточек.

## Ход игры
- текущий игрок нажимает на кнопку с кубиком, получает результат броска
- руками перемещает (свою) фишку
- в случае покупки меняет владельца карточки и обновляет свой баланс
- если покупаем отели, то переносим их руками рядом с карточкой
- потом ходит следующий игрок

## Интерфейс
- слева
	- кнопка "Правила"
	- кнопка "Сброс" (с подтверждением)
	- 4 фишки
	- 8 домиков
	- 12 отелей
	- карточка выхода из тюрьмы (с принадлежностью)
	- карточка шанс (при нажатии попап)
- внутри поля
	- по центру кубик
	- по краям карточки игроков
		- иконка с именем
		- поле с балансом, которое можно редактировать

## Задачи
### Интерфейс
- добавить карточки и кубик в цетре поля
- добавить левую панель с кнопками и иконками
- сделать обратную сторону карточек с ценами с отелем, домом и тд

### Логика
- сделать возможность перемещать фигурки и домики
- сделать чтобы у всех игроков отображалось текущее положение перемещаемых объектов
- [x] добавить логику работы кубика с синхронизацией
- редактировать поле с балансом и синхронизацию
- добавить видимость курсоров всех игроков с подписью (под вопросом)
- добавить логику отображения карточки шанс
- добавить логику изменения владельца недвижимости и отображения и карточки выхода из тюрьмы


## Документация
### Бросок кубика
При подключении к серверу клиент получает текущий стейт игры, в котором содержится текущее значение, например `dice: [0, 0]`.
При броске кубика клиент отправляет серверу event `rollDice`, сервер генерирует пару случайных чисел от 1 до 6 и отправляет всем клиентам обновленный state с новым значением кубиков.
